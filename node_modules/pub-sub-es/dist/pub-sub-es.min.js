!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).createPubSub={})}(this,(function(e){"use strict";var n=function(){try{return new window.BroadcastChannel("pub-sub-es")}catch(e){return{postMessage:function(){}}}}(),t=function(e,n){return n?e.toLowerCase():e},i=function(e,n){void 0===n&&(n={});var i=n.caseInsensitive;return function(n,s,o){void 0===o&&(o=1/0);var a=t(n,i);return e[a]||(e[a]=[],e.__times__[a]=[]),e[a].push(s),e.__times__[a].push(+o||1/0),{event:a,handler:s}}},s=function(e,n){void 0===n&&(n={});var i=n.caseInsensitive;return function(n,s){"object"==typeof n&&(s=n.handler,n=n.event);var o=t(n,i);if(e[o]){var a=e[o].indexOf(s);-1===a||a>=e[o].length||(e[o].splice(a,1),e.__times__[o].splice(a,1))}}},o=function(e,n){return function(){e.forEach((function(e){return e(n)}))}},a=function(e,i){void 0===i&&(i={});var a=i.isGlobal,c=i.caseInsensitive,r=i.async,u=s(e);return function(i,s,f){void 0===f&&(f={});var _=t(i,c);if(e[_]){var l=[].concat(e[_]);if(l.forEach((function(n,t){--e.__times__[_][t]<1&&u(_,n)})),r||f.async?setTimeout(o(l,s),0):o(l,s)(),a&&!f.isNoGlobalBroadcast)try{n.postMessage({event:_,news:s})}catch(e){if(!(e instanceof DOMException))throw e;console.warn("Could not broadcast '"+_+"' globally. Payload is not clonable.")}}}},c=function(e){return function(){Object.keys(e).filter((function(e){return"_"!==e[0]})).forEach((function(n){e[n]=void 0,e.__times__[n]=void 0,delete e[n],delete e.__times__[n]}))}},r=function(e){void 0===e&&(e={});var n=e.async;void 0===n&&(n=!1);var t=e.caseInsensitive;void 0===t&&(t=!1);var o=e.stack;return void 0===o&&(o={__times__:{}}),o.__times__||(o.__times__={}),{publish:a(o,{async:n,caseInsensitive:t}),subscribe:i(o,{caseInsensitive:t}),unsubscribe:s(o,{caseInsensitive:t}),clear:c(o),stack:o}},u={__times__:{}},f={publish:a(u,{isGlobal:!0}),subscribe:i(u),unsubscribe:s(u),stack:u};n.onmessage=function(e){var n=e.data,t=n.event,i=n.news;return f.publish(t,i,!0)},e.createPubSub=r,e.default=r,e.globalPubSub=f,Object.defineProperty(e,"__esModule",{value:!0})}));
