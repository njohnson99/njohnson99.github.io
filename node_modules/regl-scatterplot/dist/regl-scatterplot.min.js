!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("pub-sub-es"),require("regl")):"function"==typeof define&&define.amd?define(["exports","pub-sub-es","regl"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self).createScatterplot={},n.createPubSub,n.createREGL)}(this,(function(n,e,t){"use strict";function o(n){return n&&"object"==typeof n&&"default"in n?n:{default:n}}var r=o(e),i=o(t);function a(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,o)}return t}function c(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?a(Object(t),!0).forEach((function(e){l(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function l(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function u(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var t=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null==t)return;var o,r,i=[],a=!0,c=!1;try{for(t=t.call(n);!(a=(o=t.next()).done)&&(i.push(o.value),!e||i.length!==e);a=!0);}catch(n){c=!0,r=n}finally{try{a||null==t.return||t.return()}finally{if(c)throw r}}return i}(n,e)||d(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(n){return function(n){if(Array.isArray(n))return f(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||d(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(n,e){if(n){if("string"==typeof n)return f(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?f(n,e):void 0}}function f(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,o=new Array(e);t<e;t++)o[t]=n[t];return o}var v,p="undefined"!=typeof Float32Array?Float32Array:Array;function h(){var n=new p(16);return p!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function m(n){var e=new p(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function g(n,e){var t=e[0],o=e[1],r=e[2],i=e[3],a=e[4],c=e[5],l=e[6],u=e[7],s=e[8],d=e[9],f=e[10],v=e[11],p=e[12],h=e[13],m=e[14],g=e[15],y=t*c-o*a,w=t*l-r*a,x=t*u-i*a,b=o*l-r*c,M=o*u-i*c,S=r*u-i*l,A=s*h-d*p,E=s*m-f*p,C=s*g-v*p,I=d*m-f*h,P=d*g-v*h,T=f*g-v*m,R=y*T-w*P+x*I+b*C-M*E+S*A;return R?(R=1/R,n[0]=(c*T-l*P+u*I)*R,n[1]=(r*P-o*T-i*I)*R,n[2]=(h*S-m*M+g*b)*R,n[3]=(f*M-d*S-v*b)*R,n[4]=(l*C-a*T-u*E)*R,n[5]=(t*T-r*C+i*E)*R,n[6]=(m*x-p*S-g*w)*R,n[7]=(s*S-f*x+v*w)*R,n[8]=(a*P-c*C+u*A)*R,n[9]=(o*C-t*P-i*A)*R,n[10]=(p*M-h*x+g*y)*R,n[11]=(d*x-s*M-v*y)*R,n[12]=(c*E-a*I-l*A)*R,n[13]=(t*I-o*E+r*A)*R,n[14]=(h*w-p*b-m*y)*R,n[15]=(s*b-d*w+f*y)*R,n):null}function y(n,e,t){var o=e[0],r=e[1],i=e[2],a=e[3],c=e[4],l=e[5],u=e[6],s=e[7],d=e[8],f=e[9],v=e[10],p=e[11],h=e[12],m=e[13],g=e[14],y=e[15],w=t[0],x=t[1],b=t[2],M=t[3];return n[0]=w*o+x*c+b*d+M*h,n[1]=w*r+x*l+b*f+M*m,n[2]=w*i+x*u+b*v+M*g,n[3]=w*a+x*s+b*p+M*y,w=t[4],x=t[5],b=t[6],M=t[7],n[4]=w*o+x*c+b*d+M*h,n[5]=w*r+x*l+b*f+M*m,n[6]=w*i+x*u+b*v+M*g,n[7]=w*a+x*s+b*p+M*y,w=t[8],x=t[9],b=t[10],M=t[11],n[8]=w*o+x*c+b*d+M*h,n[9]=w*r+x*l+b*f+M*m,n[10]=w*i+x*u+b*v+M*g,n[11]=w*a+x*s+b*p+M*y,w=t[12],x=t[13],b=t[14],M=t[15],n[12]=w*o+x*c+b*d+M*h,n[13]=w*r+x*l+b*f+M*m,n[14]=w*i+x*u+b*v+M*g,n[15]=w*a+x*s+b*p+M*y,n}function w(n,e){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n}function x(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function b(n,e,t){var o=e[0],r=e[1],i=e[2],a=e[3];return n[0]=t[0]*o+t[4]*r+t[8]*i+t[12]*a,n[1]=t[1]*o+t[5]*r+t[9]*i+t[13]*a,n[2]=t[2]*o+t[6]*r+t[10]*i+t[14]*a,n[3]=t[3]*o+t[7]*r+t[11]*i+t[15]*a,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)}),v=new p(4),p!=Float32Array&&(v[0]=0,v[1]=0,v[2]=0,v[3]=0),function(){var n=function(){var n=new p(2);return p!=Float32Array&&(n[0]=0,n[1]=0),n}()}();const M=(n=[0,0],e=1,t=0,o=[0,0],r=[[0,1/0],[0,1/0]],i=[[-1/0,1/0],[-1/0,1/0]])=>{const a=new Float32Array(16),c=new Float32Array(16),l=new Float32Array(16);let u=h(),s=[...o.slice(0,2),0,1];const d=Array.isArray(r[0])?[...r[0]]:[...r],f=Array.isArray(r[0])?[...r[1]]:[...r],v=Array.isArray(i[0])?[...i[0]]:[...i],p=Array.isArray(i[0])?[...i[1]]:[...i],m=()=>function(n,e){var t=e[0],o=e[1],r=e[2],i=e[4],a=e[5],c=e[6],l=e[8],u=e[9],s=e[10];return n[0]=Math.hypot(t,o,r),n[1]=Math.hypot(i,a,c),n[2]=Math.hypot(l,u,s),n}(a,u).slice(0,2),M=()=>{const n=m();return Math.min(n[0],n[1])},S=()=>{const n=m();return Math.max(n[0],n[1])},A=([n=0,e=0]=[],t=1,o=0)=>{u=h(),E([-n,-e]),I(o),C(1/t)},E=([n=0,e=0]=[])=>{a[0]=n,a[1]=e,a[2]=0;const t=w(c,a);y(u,t,u)},C=(n,e)=>{const t=Array.isArray(n);let o=t?n[0]:n,r=t?n[1]:n;if(o<=0||r<=0||1===o&&1===r)return;const i=m(),v=i[0]*o,p=i[1]*r;if(o=Math.max(d[0],Math.min(v,d[1]))/i[0],r=Math.max(f[0],Math.min(p,f[1]))/i[1],1===o&&1===r)return;a[0]=o,a[1]=r,a[2]=1;const h=x(c,a),b=e?[...e,0]:s,M=w(a,b);y(u,M,y(u,h,y(u,g(l,M),u)))},I=n=>{const e=h();!function(n,e,t){var o,r,i,a=t[0],c=t[1],l=t[2],u=Math.hypot(a,c,l);u<1e-6||(a*=u=1/u,c*=u,l*=u,o=Math.sin(e),i=1-(r=Math.cos(e)),n[0]=a*a*i+r,n[1]=c*a*i+l*o,n[2]=l*a*i-c*o,n[3]=0,n[4]=a*c*i-l*o,n[5]=c*c*i+r,n[6]=l*c*i+a*o,n[7]=0,n[8]=a*l*i+c*o,n[9]=c*l*i-a*o,n[10]=l*l*i+r,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1)}(e,n,[0,0,1]),y(u,e,u)},P=n=>{!n||n.length<16||(u=n)};return A(n,e,t),{get translation(){return function(n,e){return n[0]=e[12],n[1]=e[13],n[2]=e[14],n}(a,u).slice(0,2)},get target(){return b(a,s,g(l,u)).slice(0,2)},get scaling(){return m()},get minScaling(){return M()},get maxScaling(){return S()},get scaleBounds(){return[[...d],[...f]]},get translationBounds(){return[[...v],[...p]]},get distance(){return(()=>{const n=m();return[1/n[0],1/n[1]]})()},get minDistance(){return 1/M()},get maxDistance(){return 1/S()},get rotation(){return Math.acos(u[0]/S())},get view(){return u},get viewCenter(){return s.slice(0,2)},lookAt:A,translate:E,pan:E,rotate:I,scale:C,zoom:C,reset:()=>{A(n,e,t)},set:(...n)=>(console.warn("`set()` is deprecated. Please use `setView()` instead."),P(...n)),setScaleBounds:n=>{const e=Array.isArray(n[0]);d[0]=e?n[0][0]:n[0],d[1]=e?n[0][1]:n[1],f[0]=e?n[1][0]:n[0],f[1]=e?n[1][1]:n[1]},setTranslationBounds:n=>{const e=Array.isArray(n[0]);v[0]=e?n[0][0]:n[0],v[1]=e?n[0][1]:n[1],p[0]=e?n[1][0]:n[0],p[1]=e?n[1][1]:n[1]},setView:P,setViewCenter:n=>{s=[...n.slice(0,2),0,1]}}},S=["pan","rotate"],A={alt:"altKey",cmd:"metaKey",ctrl:"ctrlKey",meta:"metaKey",shift:"shiftKey"},E=(n,{distance:e=1,target:t=[0,0],rotation:o=0,isNdc:r=!0,isFixed:i=!1,isPan:a=!0,isPanInverted:c=[!1,!0],panSpeed:l=1,isRotate:u=!0,rotateSpeed:s=1,defaultMouseDownMoveAction:d="pan",mouseDownMoveModKey:f="alt",isZoom:v=!0,zoomSpeed:p=1,viewCenter:h,scaleBounds:m,translationBounds:g,onKeyDown:y=(()=>{}),onKeyUp:w=(()=>{}),onMouseDown:x=(()=>{}),onMouseUp:b=(()=>{}),onMouseMove:E=(()=>{}),onWheel:C=(()=>{})}={})=>{let I=M(t,e,o,h,m,g),P=0,T=0,R=0,O=0,B=0,D=0,z=!1,L=0,j=1,k=1,F=1,_=!1,N=!1,V=!1,W="pan"===d,Z=a,q=a,G=c,H=c,K=v,U=v;const X=()=>{Z=Array.isArray(a)?Boolean(a[0]):a,q=Array.isArray(a)?Boolean(a[1]):a,G=Array.isArray(c)?Boolean(c[0]):c,H=Array.isArray(c)?Boolean(c[1]):c,K=Array.isArray(v)?Boolean(v[0]):v,U=Array.isArray(v)?Boolean(v[1]):v};X();const Y=r?n=>n/j*2*F:n=>n,$=r?n=>n/k*2:n=>-n,J=r?n=>(n/j*2-1)*F:n=>n,Q=r?n=>1-n/k*2:n=>n,nn=()=>{const e=n.getBoundingClientRect();j=e.width,k=e.height,F=j/k},en=n=>{V=!1,w(n)},tn=n=>{V=n[A[f]],y(n)},on=n=>{z=!1,b(n)},rn=n=>{z=1===n.buttons,x(n)},an=void 0!==document.createEvent("MouseEvent").offsetX?n=>{R=n.offsetX,O=n.offsetY}:e=>{const t=n.getBoundingClientRect();R=e.clientX-t.left,O=e.clientY-t.top},cn=n=>{P=n.clientX,T=n.clientY},ln=n=>{cn(n),E(n)},un=n=>{if(K||U){n.preventDefault(),cn(n),an(n);const e=1===n.deltaMode?12:1;L+=e*(n.deltaY||n.deltaX||0)}C(n)};window.addEventListener("keydown",tn,{passive:!0}),window.addEventListener("keyup",en,{passive:!0}),n.addEventListener("mousedown",rn,{passive:!0}),window.addEventListener("mouseup",on,{passive:!0}),window.addEventListener("mousemove",ln,{passive:!0}),n.addEventListener("wheel",un,{passive:!1}),I.config=({defaultMouseDownMoveAction:n=null,isFixed:e=null,isPan:t=null,isPanInverted:o=null,isRotate:r=null,isZoom:h=null,panSpeed:m=null,rotateSpeed:g=null,zoomSpeed:y=null,mouseDownMoveModKey:w=null}={})=>{d=null!==n&&S.includes(n)?n:d,W="pan"===d,i=null!==e?e:i,a=null!==t?t:a,c=null!==o?o:c,u=null!==r?r:u,v=null!==h?h:v,l=+m>0?m:l,s=+g>0?g:s,p=+y>0?y:p,X(),f=null!==w&&Object.keys(A).includes(w)?w:f},I.dispose=()=>{I=void 0,window.removeEventListener("keydown",tn),window.removeEventListener("keyup",en),n.removeEventListener("mousedown",rn),window.removeEventListener("mouseup",on),window.removeEventListener("mousemove",ln),n.removeEventListener("wheel",un)},I.refresh=nn,I.tick=()=>{if(i){const n=N;return N=!1,n}_=!1;const n=P,e=T;if((Z||q)&&z&&(W&&!V||!W&&V)){const t=G?B-n:n-B,o=Z?Y(l*t):0,r=H?D-e:e-D,i=q?$(l*r):0;0===o&&0===i||(I.pan([o,i]),_=!0)}if((K||U)&&L){const n=p*Math.exp(L/k),e=J(R),t=Q(O);I.scale([K?1/n:1,U?1/n:1],[e,t]),_=!0}if(u&&z&&(W&&V||!W&&!V)&&Math.abs(B-n)+Math.abs(D-e)>0){const t=j/2,o=k/2,r=B-t,i=o-D,a=n-t,c=o-e,l=function(n,e){var t=n[0],o=n[1],r=e[0],i=e[1],a=Math.sqrt(t*t+o*o)*Math.sqrt(r*r+i*i),c=a&&(t*r+o*i)/a;return Math.acos(Math.min(Math.max(c,-1),1))}([r,i],[a,c]),u=r*c-a*i;I.rotate(s*l*Math.sign(u)),_=!0}L=0,B=n,D=e;const t=_||N;return N=!1,t};const sn=n=>function(){n.apply(null,arguments),N=!0};return I.lookAt=sn(I.lookAt),I.translate=sn(I.translate),I.pan=sn(I.pan),I.rotate=sn(I.rotate),I.scale=sn(I.scale),I.zoom=sn(I.zoom),I.reset=sn(I.reset),I.set=sn(I.set),I.setScaleBounds=sn(I.setScaleBounds),I.setTranslationBounds=sn(I.setTranslationBounds),I.setView=sn(I.setView),I.setViewCenter=sn(I.setViewCenter),nn(),I};function C(n,e,t,o,r,i){if(r-o<=t)return;const a=o+r>>1;I(n,e,a,o,r,i%2),C(n,e,t,o,a-1,i+1),C(n,e,t,a+1,r,i+1)}function I(n,e,t,o,r,i){for(;r>o;){if(r-o>600){const a=r-o+1,c=t-o+1,l=Math.log(a),u=.5*Math.exp(2*l/3),s=.5*Math.sqrt(l*u*(a-u)/a)*(c-a/2<0?-1:1);I(n,e,t,Math.max(o,Math.floor(t-c*u/a+s)),Math.min(r,Math.floor(t+(a-c)*u/a+s)),i)}const a=e[2*t+i];let c=o,l=r;for(P(n,e,o,t),e[2*r+i]>a&&P(n,e,o,r);c<l;){for(P(n,e,c,l),c++,l--;e[2*c+i]<a;)c++;for(;e[2*l+i]>a;)l--}e[2*o+i]===a?P(n,e,o,l):(l++,P(n,e,l,r)),l<=t&&(o=l+1),t<=l&&(r=l-1)}}function P(n,e,t,o){T(n,t,o),T(e,2*t,2*o),T(e,2*t+1,2*o+1)}function T(n,e,t){const o=n[e];n[e]=n[t],n[t]=o}function R(n,e,t,o){const r=n-t,i=e-o;return r*r+i*i}const O=n=>n[0],B=n=>n[1];class D{constructor(n,e=O,t=B,o=64,r=Float64Array){this.nodeSize=o,this.points=n;const i=n.length<65536?Uint16Array:Uint32Array,a=this.ids=new i(n.length),c=this.coords=new r(2*n.length);for(let o=0;o<n.length;o++)a[o]=o,c[2*o]=e(n[o]),c[2*o+1]=t(n[o]);C(a,c,o,0,a.length-1,0)}range(n,e,t,o){return function(n,e,t,o,r,i,a){const c=[0,n.length-1,0],l=[];let u,s;for(;c.length;){const d=c.pop(),f=c.pop(),v=c.pop();if(f-v<=a){for(let a=v;a<=f;a++)u=e[2*a],s=e[2*a+1],u>=t&&u<=r&&s>=o&&s<=i&&l.push(n[a]);continue}const p=Math.floor((v+f)/2);u=e[2*p],s=e[2*p+1],u>=t&&u<=r&&s>=o&&s<=i&&l.push(n[p]);const h=(d+1)%2;(0===d?t<=u:o<=s)&&(c.push(v),c.push(p-1),c.push(h)),(0===d?r>=u:i>=s)&&(c.push(p+1),c.push(f),c.push(h))}return l}(this.ids,this.coords,n,e,t,o,this.nodeSize)}within(n,e,t){return function(n,e,t,o,r,i){const a=[0,n.length-1,0],c=[],l=r*r;for(;a.length;){const u=a.pop(),s=a.pop(),d=a.pop();if(s-d<=i){for(let r=d;r<=s;r++)R(e[2*r],e[2*r+1],t,o)<=l&&c.push(n[r]);continue}const f=Math.floor((d+s)/2),v=e[2*f],p=e[2*f+1];R(v,p,t,o)<=l&&c.push(n[f]);const h=(u+1)%2;(0===u?t-r<=v:o-r<=p)&&(a.push(d),a.push(f-1),a.push(h)),(0===u?t+r>=v:o+r>=p)&&(a.push(f+1),a.push(s),a.push(h))}return c}(this.ids,this.coords,n,e,t,this.nodeSize)}}const{push:z,splice:L}=Array.prototype,j=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),k=Float32Array.BYTES_PER_ELEMENT,F={duplicate(n,e=1,t=1){const o=[],r=new Array(2*e);for(let i=0,a=n.length/e;i<a;i++){const a=i*e;for(let o=0;o<e;o++){const i=n[a+o];r[o]=i,r[o+e]=i*t}z.apply(o,r)}return o},mapElement(n,e,t,o){for(let r=0,i=n.length/t;r<i;r++){const i=e+r*t;n[i]=o(n[i],i,r)}return n},copyElement(n,e,t,o){const r=new Array(o),i=e*o;for(let e=0;e<o;e++)r[e]=n[i+e];return L.call(n,t*o,0,...r),n},increaseStride(n,e,t,o=0){const r=[],i=new Array(t).fill(o);for(let t=0,o=n.length/e;t<o;t++){const o=t*e;for(let t=0;t<e;t++)i[t]=n[o+t];z.apply(r,i)}return r}},_=(n,{projection:e=j,model:t=j,view:o=j,points:r=[],colorIndices:i=[],color:a=[.8,.5,0,1],opacity:c=null,opacities:l=[],width:u=1,widths:s=[],miter:d=1,is2d:f=!1,zPos2d:v=0}={})=>{if(!n)return void console.error("Regl instance is undefined.");const p=new Float32Array(16);let h,m,g,w,x,b,M,S,A,E,C,I,P,T,R,O,B,D,z=f?2:3;const L=()=>+(l.length===m||null!==c),_=()=>{E=n.buffer(),C=n.buffer(),I=n.buffer(),R=n.buffer(),O={prevPosition:{buffer:()=>E,offset:0,stride:3*k},currPosition:{buffer:()=>E,offset:3*k*2,stride:3*k},nextPosition:{buffer:()=>E,offset:3*k*4,stride:3*k},opacity:{buffer:()=>C,offset:2*k,stride:k},offsetScale:{buffer:()=>I,offset:2*k,stride:k},colorIndex:{buffer:()=>R,offset:2*k,stride:k}},B=n.elements(),D=n({attributes:O,depth:{enable:!f},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},uniforms:{projectionViewModel:(n,e)=>{const t=n.projection||e.projection,o=n.model||e.model,r=n.view||e.view;return y(p,t,y(p,r,o))},aspectRatio:({viewportWidth:n,viewportHeight:e})=>n/e,colorTex:()=>P,colorTexRes:()=>T,colorTexEps:()=>.5/T,pixelRatio:({pixelRatio:n})=>n,width:({pixelRatio:n,viewportHeight:e})=>u/e*n,useOpacity:L,useColorOpacity:()=>+!L(),miter:d},elements:()=>B,vert:"\nuniform mat4 projectionViewModel;\nuniform float aspectRatio;\n\nuniform sampler2D colorTex;\nuniform float colorTexRes;\nuniform float colorTexEps;\nuniform float width;\nuniform float useOpacity;\nuniform float useColorOpacity;\nuniform int miter;\n\nattribute vec3 prevPosition;\nattribute vec3 currPosition;\nattribute vec3 nextPosition;\nattribute float opacity;\nattribute float offsetScale;\nattribute float colorIndex;\n\nvarying vec4 color;\n\nvoid main() {\n  vec2 aspectVec = vec2(aspectRatio, 1.0);\n  vec4 prevProjected = projectionViewModel * vec4(prevPosition, 1.0);\n  vec4 currProjected = projectionViewModel * vec4(currPosition, 1.0);\n  vec4 nextProjected = projectionViewModel * vec4(nextPosition, 1.0);\n\n  // get 2D screen space with W divide and aspect correction\n  vec2 prevScreen = prevProjected.xy / prevProjected.w * aspectVec;\n  vec2 currScreen = currProjected.xy / currProjected.w * aspectVec;\n  vec2 nextScreen = nextProjected.xy / nextProjected.w * aspectVec;\n\n  // starting point uses (next - current)\n  vec2 dir = vec2(0.0);\n  if (currScreen == prevScreen) {\n    dir = normalize(nextScreen - currScreen);\n  }\n  // ending point uses (current - previous)\n  else if (currScreen == nextScreen) {\n    dir = normalize(currScreen - prevScreen);\n  }\n  // somewhere in middle, needs a join\n  else {\n    // get directions from (C - B) and (B - A)\n    vec2 dirA = normalize((currScreen - prevScreen));\n    if (miter == 1) {\n      vec2 dirB = normalize((nextScreen - currScreen));\n      // now compute the miter join normal and length\n      vec2 tangent = normalize(dirA + dirB);\n      vec2 perp = vec2(-dirA.y, dirA.x);\n      vec2 miter = vec2(-tangent.y, tangent.x);\n      dir = tangent;\n    } else {\n      dir = dirA;\n    }\n  }\n\n  vec2 normal = vec2(-dir.y, dir.x) * width;\n  normal.x /= aspectRatio;\n  vec4 offset = vec4(normal * offsetScale, 0.0, 0.0);\n  gl_Position = currProjected + offset;\n\n  // Get color from texture\n  float colorRowIndex = floor((colorIndex + colorTexEps) / colorTexRes);\n  vec2 colorTexIndex = vec2(\n    (colorIndex / colorTexRes) - colorRowIndex + colorTexEps,\n    colorRowIndex / colorTexRes + colorTexEps\n  );\n\n  color = texture2D(colorTex, colorTexIndex);\n  color.a = useColorOpacity * color.a + useOpacity * opacity;\n}",frag:"\nprecision mediump float;\nvarying vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}"})},N=()=>{V(),_()},V=()=>{r=null,w=null,x=null,S=null,A=null,E.destroy(),I.destroy(),B.destroy()},W=(n,e)=>{const t=e.flat(2);return t.length===m?t:t.length===h?g.map(((n,e)=>Array(n).fill(t[e]))).flat():n},Z=(n=[],{colorIndices:e=i,opacities:t=l,widths:o=s,is2d:a=f}={})=>{r=n,z=(f=a)?2:3,h=Array.isArray(r[0])?r.length:1,g=h>1?r.map((n=>Math.floor(n.length/z))):[Math.floor(r.length/z)],m=g.reduce(((n,e)=>n+e),0),i=W(i,e),l=W(l,t),s=W(s,o),r&&m>1?(()=>{1===h&&r.length%z>0&&console.warn(`The length of points (${m}) does not match the dimensions (${z}). Incomplete points are ignored.`),w=r.flat().slice(0,m*z),f&&(w=F.increaseStride(w,2,3,v)),i.length!==m&&(i=new Array(m).fill(0)),s.length!==m&&(s=new Array(m).fill(1));let n=i.slice(),e=l.length===m?l.slice():new Array(m).fill(+c),t=s.slice(),o=0;g.forEach((r=>{const i=o+r-1;F.copyElement(w,i,i,3),F.copyElement(w,o,o,3),F.copyElement(n,i,i,1),F.copyElement(n,o,o,1),F.copyElement(e,i,i,1),F.copyElement(e,o,o,1),F.copyElement(t,i,i,1),F.copyElement(t,o,o,1),o+=r+2})),x=new Float32Array(F.duplicate(w,3)),b=F.duplicate(n),M=F.duplicate(e),S=F.duplicate(t,1,-1),A=((n,e=[])=>{let t=0;return n.forEach((n=>{for(let o=0;o<n-1;o++){const n=t+2*o,r=n+1,i=n+2,a=n+3;e.push(n,r,i,i,r,a)}t+=2*(n+2)})),e})(g),E({usage:"dynamic",type:"float",length:x.length*k,data:x}),C({usage:"dynamic",type:"float",length:M.length*k,data:M}),I({usage:"dynamic",type:"float",length:S.length*k,data:S}),R({usage:"dynamic",type:"float",length:b.length*k,data:b}),B({primitive:"triangles",usage:"dynamic",type:A.length>65536?"uint32":"uint16",data:A})})():N()},q=(n,e=-1)=>Array.isArray(n)?n.length&&!Array.isArray(n[0])?e+1:q(n[0],++e):e,G=()=>{const e=0===q(a)?[a]:a;T=Math.max(2,Math.ceil(Math.sqrt(e.length)));const t=new Uint8Array(T**2*4);e.forEach(((n,e)=>{t[4*e]=Math.min(255,Math.max(0,Math.round(255*n[0]))),t[4*e+1]=Math.min(255,Math.max(0,Math.round(255*n[1]))),t[4*e+2]=Math.min(255,Math.max(0,Math.round(255*n[2]))),t[4*e+3]=Number.isNaN(+n[3])?255:Math.min(255,Math.max(0,Math.round(255*n[3])))})),P=n.texture({data:t,shape:[T,T,4]})};return _(),G(),r&&r.length>1&&Z(r),{clear:N,destroy:V,draw:({projection:n,model:i,view:a}={})=>{n&&(e=n),i&&(t=i),a&&(o=a),r&&r.length>1&&D({projection:e,model:t,view:o})},getPoints:()=>r,setPoints:Z,getData:()=>({points:x,widths:S,opacities:M,colorIndices:b}),getBuffer:()=>({points:E,widths:I,opacities:C,colorIndices:R}),getStyle:()=>({color:a,miter:d,width:u}),setStyle:({color:n,opacity:e,miter:t,width:o}={})=>{n&&((n,e=c)=>{a=n,c=e,P&&P.destroy(),G()})(n,e),t&&(d=t),+o>0&&(u=o)}}},N=n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,V=n=>n,W=(n,e=(n=>n))=>{const t=[];for(let o=0;o<n;o++)t.push(e(o,n));return t},Z=(n,e)=>{const t=[];return n.forEach((n=>{t[n]=!0})),e.forEach((n=>{t[n]=!0})),t.reduce(((n,e,t)=>(e&&n.push(t),n)),[])},q=(n,...e)=>(e.forEach((e=>{const t=Object.keys(e).reduce(((n,t)=>(n[t]=Object.getOwnPropertyDescriptor(e,t),n)),{});Object.getOwnPropertySymbols(e).forEach((n=>{const o=Object.getOwnPropertyDescriptor(e,n);o.enumerable&&(t[n]=o)})),Object.defineProperties(n,t)})),n),G=(...n)=>e=>n.reduce(((n,e)=>e(n)),e),H=n=>e=>q({__proto__:{constructor:n}},e),K=(n,e)=>t=>q(t,{get[n](){return e}}),U=(n,e,t,o)=>Math.sqrt((n-t)**2+(e-o)**2),X=n=>new Worker(window.URL.createObjectURL(new Blob([`(${n.toString()})()`],{type:"text/javascript"}))),Y=(n=1)=>new Promise((e=>{let t=0;const o=()=>requestAnimationFrame((()=>{t++,t<n?o():e()}));o()})),$=(n,e,t=null)=>{let o,r=0;t=null===t?e:t;const i=(...e)=>{clearTimeout(o),o=setTimeout((()=>{r>0&&(n(...e),r=0)}),t)};let a=!1;const c=(...t)=>{a?(r++,i(...t)):(n(...t),i(...t),a=!0,r=0,setTimeout((()=>{a=!1}),e))};return c.reset=()=>{a=!1},c.cancel=()=>{clearTimeout(o)},c.now=(...e)=>n(...e),c},J=n=>new Promise((e=>setTimeout(e,n)));var Q,nn="auto",en=Float32Array.BYTES_PER_ELEMENT,tn=["OES_texture_float","OES_element_index_uint","WEBGL_color_buffer_float","EXT_float_blend"],on={color:[0,0,0,0],depth:1},rn="panZoom",an="lasso",cn="rotate",ln=[rn,an,cn],un=rn,sn={cubicIn:n=>n*n*n,cubicInOut:N,cubicOut:n=>--n*n*n+1,linear:n=>n,quadIn:n=>n*n,quadInOut:n=>n<.5?2*n*n:(4-2*n)*n-1,quadOut:n=>n*(2-n)},dn=N,fn="deselect",vn="lassoEnd",pn=[fn,vn],hn=[0,.666666667,1,1],mn=vn,gn="lasso",yn="rotate",wn="merge",xn=[gn,yn,wn],bn="alt",Mn="cmd",Sn="ctrl",An="meta",En="shift",Cn=[bn,Mn,Sn,An,En],In=(l(Q={},bn,yn),l(Q,En,gn),l(Q,Mn,wn),Q),Pn=nn,Tn=nn,Rn=null,On=null,Bn=null,Dn=null,zn=null,Ln=[.66,.66,.66,1],jn=[0,.55,1,1],kn=[1,1,1,1],Fn=[0,0,0,1],_n=null,Nn=[.66,.66,.66,.2],Vn=[0,.55,1,1],Wn=[1,1,1,1],Zn=[0,0],qn=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Gn="IMAGE_LOAD_ERROR",Hn=[1,1,1,.5],Kn="auto",Un=new Set(["z","valueZ","valueA","value1","category"]),Xn=new Set(["w","valueW","valueB","value2","value"]),Yn=15e3,$n=function(n,e){return!!n&&tn.reduce((function(t,o){return n.hasExtension(o)?t:(e||console.warn("WebGL: ".concat(o," extension not supported. Scatterplot might not render properly")),!1)}),!0)},Jn=function(n){var e=n.getContext("webgl",{antialias:!0,preserveDrawingBuffer:!0}),t=[];return tn.forEach((function(n){e.getExtension(n)?t.push(n):console.warn("WebGL: ".concat(n," extension not supported. Scatterplot might not render properly"))})),i.default({gl:e,extensions:t})},Qn=function(n,e,t,o){return Math.sqrt(Math.pow(n-t,2)+Math.pow(e-o,2))},ne=function(n){for(var e=1/0,t=-1/0,o=1/0,r=-1/0,i=0;i<n.length;i+=2)e=n[i]<e?n[i]:e,t=n[i]>t?n[i]:t,o=n[i+1]<o?n[i+1]:o,r=n[i+1]>r?n[i+1]:r;return[e,o,t,r]},ee=function(n){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(n,e,t,o){return"#".concat(e).concat(e).concat(t).concat(t).concat(o).concat(o)})).substring(1).match(/.{2}/g).map((function(n){return parseInt(n,16)/Math.pow(255,e)}))},te=function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.minLength,r=void 0===o?0:o;return Array.isArray(n)&&n.length>=r&&n.every(e)},oe=function(n){return!Number.isNaN(+n)&&+n>=0},re=function(n){return!Number.isNaN(+n)&&+n>0},ie=function(n,e){return function(t){return n.indexOf(t)>=0?t:e}},ae=function(n){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Yn;return new Promise((function(o,r){var i=new Image;e&&(i.crossOrigin="anonymous"),i.src=n,i.onload=function(){o(i)};var a=function(){r(new Error(Gn))};i.onerror=a,setTimeout(a,t)}))},ce=function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Yn;return new Promise((function(o,r){ae(e,0!==e.indexOf(window.location.origin)&&-1===e.indexOf("base64"),t).then((function(e){o(n.texture(e))})).catch((function(n){r(n)}))}))},le=function(n){return n>=0&&n<=1},ue=function(n){return Array.isArray(n)&&n.every(le)},se=function(n){for(var e,t,o,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=u(i,2),c=a[0],l=a[1],s=!1,d=0,f=n.length-2;d<n.length;d+=2)e=n[d],t=n[d+1],o=n[f],t>l!=(r=n[f+1])>l&&c<(o-e)*(l-t)/(r-t)+e&&(s=!s),f=d;return s},de=function(n){return"string"==typeof n||n instanceof String},fe=function(n){return Number.isInteger(n)&&n>=0&&n<=255},ve=function(n){return Array.isArray(n)&&n.every(fe)},pe=function(n){return Array.isArray(n)&&n.length&&(Array.isArray(n[0])||de(n[0]))},he=function(n,e){return n>e?n:e},me=function(n,e){return n<e?n:e},ge=function(n,e){if(4===(o=n).length&&(ue(o)||ve(o))){var t=ue(n);return e&&t||!e&&!t?n:e&&!t?n.map((function(n){return n/255})):n.map((function(n){return 255*n}))}var o,r;if(3===(r=n).length&&(ue(r)||ve(r))){var i=Math.pow(255,!e),a=ue(n);return[].concat(e&&a||!e&&!a?s(n):s(e&&!a?n.map((function(n){return n/255})):n.map((function(n){return 255*n}))),[i])}return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n)?function(n){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return[].concat(s(ee(n,e)),[Math.pow(255,!e)])}(n,e):(console.warn("Only HEX, RGB, and RGBA are handled by this function. Returning white instead."),e?[1,1,1,1]:[255,255,255,255])},ye=function(n){return Object.entries(n).reduce((function(n,e){var t=u(e,2),o=t[0],r=t[1];return n[r]?n[r]=[].concat(s(n[r]),[o]):n[r]=o,n}),{})},we=function(n){return.21*n[0]+.72*n[1]+.07*n[2]},xe=function(n,e,t){return Math.min(t,Math.max(e,n))},be=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.regl,t=n.canvas,o=void 0===t?document.createElement("canvas"):t,r=n.gamma,i=void 0===r?1:r;e||(e=Jn(o));var a=$n(e),c=[o.width,o.height],l=e.framebuffer({width:c[0],height:c[1],colorFormat:"rgba",colorType:"float"}),u=e({vert:"\n      precision highp float;\n      attribute vec2 xy;\n      void main () {\n        gl_Position = vec4(xy, 0, 1);\n      }",frag:"\n      precision highp float;\n      uniform vec2 srcRes;\n      uniform sampler2D src;\n      uniform float gamma;\n\n      vec3 approxLinearToSRGB (vec3 rgb, float gamma) {\n        return pow(clamp(rgb, vec3(0), vec3(1)), vec3(1.0 / gamma));\n      }\n\n      void main () {\n        vec4 color = texture2D(src, gl_FragCoord.xy / srcRes);\n        gl_FragColor = vec4(approxLinearToSRGB(color.rgb, gamma), color.a);\n      }",attributes:{xy:[-4,-4,4,-4,0,4]},uniforms:{src:function(){return l},srcRes:function(){return c},gamma:function(){return i}},count:3,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"one",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}}}),s=function(n){var e=n.getContext("2d");e.clearRect(0,0,n.width,n.height),e.drawImage(o,(o.width-n.width)/2,(o.height-n.height)/2,n.width,n.height,0,0,n.width,n.height)},d=function(n,t){e.clear(on),l.use((function(){e.clear(on),n(t.width/o.width,t.height/o.height)})),u(),s(t)},f=function(){e.poll()},v=new Set,p=function(n){return v.add(n),function(){v.delete(n)}},h=e.frame((function(){for(var n=v.values(),e=n.next();!e.done;)e.value(),e=n.next()})),m=function(){o.width=window.innerWidth*window.devicePixelRatio,o.height=window.innerHeight*window.devicePixelRatio,c[0]=o.width,c[1]=o.height,l.resize.apply(l,c)};n.canvas||(window.addEventListener("resize",m),window.addEventListener("orientationchange",m),m());var g=function(){h.cancel(),o=void 0,e=void 0,window.removeEventListener("resize",m),window.removeEventListener("orientationchange",m)};return{get canvas(){return o},get regl(){return e},get gamma(){return i},set gamma(n){i=+n},get isSupported(){return a},render:d,onFrame:p,refresh:f,destroy:g}},Me=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===n?e:n},Se=document.createElement("style");document.head.appendChild(Se);var Ae=Se.sheet,Ee=function(n){var e=Ae.rules.length;return Ae.insertRule(n,e),e},Ce=function(n){Ae.deleteRule(n)},Ie="".concat(2500,"ms ease scaleInFadeOut 0s 1 normal backwards"),Pe=function(n,e,t){return"\n@keyframes scaleInFadeOut {\n  0% {\n    opacity: ".concat(n,";\n    transform: translate(-50%,-50%) scale(").concat(e,") rotate(").concat(t,"deg);\n  }\n  10% {\n    opacity: 1;\n    transform: translate(-50%,-50%) scale(1) rotate(").concat(t+20,"deg);\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0.9) rotate(").concat(t+60,"deg);\n  }\n}\n")},Te=null,Re="".concat(250,"ms ease fadeScaleOut 0s 1 normal backwards"),Oe=function(n,e,t){return"\n@keyframes fadeScaleOut {\n  0% {\n    opacity: ".concat(n,";\n    transform: translate(-50%,-50%) scale(").concat(e,") rotate(").concat(t,"deg);\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0) rotate(").concat(t,"deg);\n  }\n}\n")},Be=null,De=function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t.onDraw,r=void 0===o?V:o,i=t.onStart,a=void 0===i?V:i,c=t.onEnd,l=void 0===c?V:c,u=t.enableInitiator,d=void 0===u||u,f=t.initiatorParentElement,v=void 0===f?document.body:f;t.minDelay,t.minDist;var p=t.pointNorm,h=void 0===p?V:p,m=d,g=v,y=r,w=a,x=l,b=h,M=document.createElement("div"),S=Math.random().toString(36).substring(2,5)+Math.random().toString(36).substring(2,5);M.id="lasso-initiator-".concat(S),M.style.position="fixed",M.style.display="flex",M.style.justifyContent="center",M.style.alignItems="center",M.style.zIndex=99,M.style.width="4rem",M.style.height="4rem",M.style.borderRadius="4rem",M.style.opacity=.5,M.style.transform="translate(-50%,-50%) scale(0) rotate(0deg)";var A,E=!1,C=!1,I=[],P=[],T=function(){E=!1},R=function(n){var t=e.getBoundingClientRect(),o=t.left,r=t.top;return[n.clientX-o,n.clientY-r]};window.addEventListener("mouseup",T);var O=function(){M.style.opacity=.5,M.style.transform="translate(-50%,-50%) scale(0) rotate(0deg)"},B=function(){var n=getComputedStyle(M),e=+n.opacity,t=n.transform.match(/([0-9.-]+)+/g),o=+t[0],r=+t[1];return{opacity:e,scale:Math.sqrt(o*o+r*r),rotate:Math.atan2(r,o)*(180/Math.PI)}},D=function(n){m&&J(0).then((function(){var e=n.clientX,t=n.clientY;if(!E){var o,r,i,a=B();o=a.opacity,r=a.scale,i=a.rotate,M.style.opacity=o,M.style.transform="translate(-50%,-50%) scale(".concat(r,") rotate(").concat(i,"deg)"),M.style.animation="none",Y(2).then((function(){M.style.top="".concat(t,"px"),M.style.left="".concat(e,"px"),null!==Te&&Ce(Te),Te=Ee(Pe(o,r,i)),M.style.animation=Ie,Y().then((function(){O()}))}))}}))},z=function(){var n=B(),e=n.opacity,t=n.scale,o=n.rotate;M.style.opacity=e,M.style.transform="translate(-50%,-50%) scale(".concat(t,") rotate(").concat(o,"deg)"),M.style.animation="none",Y(2).then((function(){null!==Be&&Ce(Be),Be=Ee(Oe(e,t,o)),M.style.animation=Re,Y().then((function(){O()}))}))},L=function(){y(I,P)},j=function(n){if(A){if(U(n[0],n[1],A[0],A[1])>2){A=n;var e=b(n);I.push(e),P.push(e[0],e[1]),I.length>1&&L()}}else{C||(C=!0,w()),A=n;var t=b(n);I=[t],P=[t[0],t[1]]}},k=$(j,8,8),F=function(n,e){var t=R(n);return e?k(t):j(t)},_=function(){I=[],P=[],A=void 0,L()},N=function(n){D(n)},W=function(){E=!0,C=!0,_(),w()},Z=function(){z()},X=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.merge,t=void 0!==e&&e;C=!1;var o=s(I),r=s(P);return k.cancel(),_(),o.length&&x(o,r,{merge:t}),o},Q=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.onDraw,t=void 0===e?null:e,o=n.onStart,r=void 0===o?null:o,i=n.onEnd,a=void 0===i?null:i,c=n.enableInitiator,l=void 0===c?null:c,u=n.initiatorParentElement,s=void 0===u?null:u;n.minDelay,n.minDist;var d=n.pointNorm,f=void 0===d?null:d;y=Me(t,y),w=Me(r,w),x=Me(a,x),m=Me(l,m),b=Me(f,b),null!==s&&s!==g&&(g.removeChild(M),s.appendChild(M),g=s),m?(M.addEventListener("click",N),M.addEventListener("mousedown",W),M.addEventListener("mouseleave",Z)):(M.removeEventListener("mousedown",W),M.removeEventListener("mouseleave",Z))},nn=function(){g.removeChild(M),window.removeEventListener("mouseup",T),M.removeEventListener("click",N),M.removeEventListener("mousedown",W),M.removeEventListener("mouseleave",Z)},en=function(){return function(n){return q(n,{clear:_,destroy:nn,end:X,extend:F,set:Q,showInitiator:D,hideInitiator:z})}};return g.appendChild(M),Q({onDraw:y,onStart:w,onEnd:x,enableInitiator:m,initiatorParentElement:g}),G(K("initiator",M),en(),H(n))({})};const ze="\nprecision mediump float;\n\nuniform sampler2D texture;\n\nvarying vec2 uv;\n\nvoid main () {\n  gl_FragColor = texture2D(texture, uv);\n}\n",Le="\nprecision mediump float;\n\nuniform mat4 modelViewProjection;\n\nattribute vec2 position;\n\nvarying vec2 uv;\n\nvoid main () {\n  uv = position;\n  gl_Position = modelViewProjection * vec4(-1.0 + 2.0 * uv.x, 1.0 - 2.0 * uv.y, 0, 1);\n}\n",je="\nprecision highp float;\n\nvarying vec4 color;\nvarying float finalPointSize;\n\nfloat linearstep(float edge0, float edge1, float x) {\n  return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n}\n\nvoid main() {\n  vec2 c = gl_PointCoord * 2.0 - 1.0;\n  float sdf = length(c) * finalPointSize;\n  float alpha = linearstep(finalPointSize + 0.5, finalPointSize - 0.5, sdf);\n\n  gl_FragColor = vec4(color.rgb, alpha * color.a);\n}\n",ke="precision highp float;\n\nvarying vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n",Fe=n=>`\nprecision highp float;\n\nuniform sampler2D colorTex;\nuniform float colorTexRes;\nuniform float colorTexEps;\nuniform sampler2D stateTex;\nuniform float stateTexRes;\nuniform float stateTexEps;\nuniform float devicePixelRatio;\nuniform sampler2D encodingTex;\nuniform float encodingTexRes;\nuniform float encodingTexEps;\nuniform float pointSizeExtra;\nuniform float pointOpacityMax;\nuniform float pointOpacityScale;\nuniform float numPoints;\nuniform float globalState;\nuniform float isColoredByZ;\nuniform float isColoredByW;\nuniform float isOpacityByZ;\nuniform float isOpacityByW;\nuniform float isOpacityByDensity;\nuniform float isSizedByZ;\nuniform float isSizedByW;\nuniform float colorMultiplicator;\nuniform float opacityMultiplicator;\nuniform float opacityDensity;\nuniform float sizeMultiplicator;\nuniform float numColorStates;\nuniform float pointScale;\nuniform mat4 modelViewProjection;\n\nattribute vec2 stateIndex;\n\nvarying vec4 color;\nvarying float finalPointSize;\n\nvoid main() {\n  vec4 state = texture2D(stateTex, stateIndex);\n\n  gl_Position = modelViewProjection * vec4(state.x, state.y, 0.0, 1.0);\n\n  // Determine color index\n  float colorIndexZ =  isColoredByZ * floor(state.z * colorMultiplicator);\n  float colorIndexW =  isColoredByW * floor(state.w * colorMultiplicator);\n\n  // Multiply by the number of color states per color\n  // I.e., normal, active, hover, background, etc.\n  float colorIndex = (colorIndexZ + colorIndexW) * numColorStates;\n\n  // Half a "pixel" or "texel" in texture coordinates\n  float colorLinearIndex = colorIndex + globalState;\n\n  // Need to add cEps here to avoid floating point issue that can lead to\n  // dramatic changes in which color is loaded as floor(3/2.9999) = 1 but\n  // floor(3/3.0001) = 0!\n  float colorRowIndex = floor((colorLinearIndex + colorTexEps) / colorTexRes);\n\n  vec2 colorTexIndex = vec2(\n    (colorLinearIndex / colorTexRes) - colorRowIndex + colorTexEps,\n    colorRowIndex / colorTexRes + colorTexEps\n  );\n\n  color = texture2D(colorTex, colorTexIndex);\n\n  // Retrieve point size\n  float pointSizeIndexZ = isSizedByZ * floor(state.z * sizeMultiplicator);\n  float pointSizeIndexW = isSizedByW * floor(state.w * sizeMultiplicator);\n  float pointSizeIndex = pointSizeIndexZ + pointSizeIndexW;\n\n  float pointSizeRowIndex = floor((pointSizeIndex + encodingTexEps) / encodingTexRes);\n  vec2 pointSizeTexIndex = vec2(\n    (pointSizeIndex / encodingTexRes) - pointSizeRowIndex + encodingTexEps,\n    pointSizeRowIndex / encodingTexRes + encodingTexEps\n  );\n  float pointSize = texture2D(encodingTex, pointSizeTexIndex).x;\n\n  // Retrieve opacity\n  ${3===n?"":`\n        if (isOpacityByDensity < 0.5) {\n          float opacityIndexZ = isOpacityByZ * floor(state.z * opacityMultiplicator);\n          float opacityIndexW = isOpacityByW * floor(state.w * opacityMultiplicator);\n          float opacityIndex = opacityIndexZ + opacityIndexW;\n\n          float opacityRowIndex = floor((opacityIndex + encodingTexEps) / encodingTexRes);\n          vec2 opacityTexIndex = vec2(\n            (opacityIndex / encodingTexRes) - opacityRowIndex + encodingTexEps,\n            opacityRowIndex / encodingTexRes + encodingTexEps\n          );\n          color.a = texture2D(encodingTex, opacityTexIndex)[${1+n}];\n        } else {\n          color.a = min(1.0, opacityDensity + globalState);\n        }\n      `}\n\n  color.a = min(pointOpacityMax, color.a) * pointOpacityScale;\n  finalPointSize = (pointSize * pointScale) + pointSizeExtra;\n  gl_PointSize = finalPointSize;\n}\n`,_e="precision highp float;\n\nuniform sampler2D startStateTex;\nuniform sampler2D endStateTex;\nuniform float t;\n\nvarying vec2 particleTextureIndex;\n\nvoid main() {\n  // Interpolate x, y, and value\n  vec3 start = texture2D(startStateTex, particleTextureIndex).xyw;\n  vec3 end = texture2D(endStateTex, particleTextureIndex).xyw;\n  vec3 curr = start * (1.0 - t) + end * t;\n\n  // The category cannot be interpolated\n  float endCategory = texture2D(endStateTex, particleTextureIndex).z;\n\n  gl_FragColor = vec4(curr.xy, endCategory, curr.z);\n}",Ne="precision highp float;\n\nattribute vec2 position;\nvarying vec2 particleTextureIndex;\n\nvoid main() {\n  // map normalized device coords to texture coords\n  particleTextureIndex = 0.5 * (1.0 + position);\n\n  gl_Position = vec4(position, 0, 1);\n}";var Ve=function(){var n=function(n,e,t,o,r){var i=.5*(o-e),a=.5*(r-t);return(2*t-2*o+i+a)*n*n*n+(-3*t+3*o-2*i-a)*n*n+i*n+t},e=function(e,t,o){var r=o*e,i=Math.floor(r),a=r-i,c=t[Math.max(0,i-1)],l=t[i],u=t[Math.min(o,i+1)],s=t[Math.min(o,i+2)];return[n(a,c[0],l[0],u[0],s[0]),n(a,c[1],l[1],u[1],s[1])]},t=function(n,e,t,o){return Math.pow(n-t,2)+Math.pow(e-o,2)},o=function(n,e,t){var o=e[0],r=e[1],i=t[0]-o,a=t[1]-r;if(0!==i||0!==a){var c=((n[0]-o)*i+(n[1]-r)*a)/(i*i+a*a);c>1?(o=t[0],r=t[1]):c>0&&(o+=i*c,r+=a*c)}return(i=n[0]-o)*i+(a=n[1]-r)*a},r=function n(e,t,r,i,a){for(var c,l=i,u=t+1;u<r;u++){var s=o(e[u],e[t],e[r]);s>l&&(c=u,l=s)}l>i&&(c-t>1&&n(e,t,c,i,a),a.push(e[c]),r-c>1&&n(e,c,r,i,a))},i=function(n,e){var t=n.length-1,o=[n[0]];return r(n,0,t,e,o),o.push(n[t]),o};self.onmessage=function(n){(n.data.points?+n.data.points.length:0)||self.postMessage({error:new Error("No points provided")}),n.data.points;var o=function(n){var e={},t=!Number.isNaN(+n[0][5]);return n.forEach((function(n){var o=n[4];e[o]||(e[o]=[]),t?e[o][n[5]]=n:e[o].push(n)})),Object.entries(e).forEach((function(n){e[n[0]]=n[1].filter((function(n){return n})),e[n[0]].reference=n[1][0]})),e}(n.data.points);self.postMessage({points:Object.entries(o).reduce((function(o,r){return o[r[0]]=function(n){for(var o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.maxIntPointsPerSegment,c=void 0===a?100:a,l=r.tolerance,u=void 0===l?.002:l,s=n.length,d=s-1,f=d*c+1,v=Math.pow(u,2),p=[],h=0;h<s-1;h++){var m=[n[h].slice(0,2)];o=n[h];for(var g=1;g<c;g++){var y=e((h*c+g)/f,n,d);t(o[0],o[1],y[0],y[1])>v&&(m.push(y),o=y)}m.push(n[h+1]),m=i(m,v),p=p.concat(m.slice(0,m.length-1))}return p.push(n[n.length-1].slice(0,2)),p.flat()}(r[1],n.data.options),o[r[0]].reference=r[1].reference,o}),{})})}},We=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{tolerance:.002,maxIntPointsPerSegment:100};return new Promise((function(t,o){var r=X(Ve);r.onmessage=function(n){n.data.error?o(n.data.error):t(n.data.points),r.terminate()},r.postMessage({points:n,options:e})}))},Ze="1.4.2",qe={showRecticle:"showReticle",recticleColor:"reticleColor"},Ge=function(n){Object.keys(n).filter((function(n){return qe[n]})).forEach((function(e){console.warn('regl-scatterplot: the "'.concat(e,'" property is deprecated. Please use "').concat(qe[e],'" instead.')),n[qe[e]]=n[e],delete n[e]}))},He=function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.allowSegment,r=void 0!==o&&o,i=t.allowDensity,a=void 0!==i&&i;return Un.has(n)?"valueZ":Xn.has(n)?"valueW":"segment"===n?r?"segment":e:"density"===n&&a?"density":e},Ke=function(n){switch(n){case"valueZ":return 2;case"valueW":return 3;default:return null}};n.checkSupport=$n,n.createRegl=Jn,n.createRenderer=be,n.createTextureFromUrl=ce,n.default=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=r.default({async:!n.syncEvents,caseInsensitive:!0}),t=new Float32Array(16),o=new Float32Array(16),i=[0,0];Ge(n);var a=n.renderer,l=n.backgroundColor,d=void 0===l?Fn:l,f=n.backgroundImage,v=void 0===f?null:f,p=n.canvas,h=void 0===p?document.createElement("canvas"):p,w=n.colorBy,M=void 0===w?zn:w,S=n.deselectOnDblClick,A=void 0===S||S,C=n.deselectOnEscape,I=void 0===C||C,P=n.lassoColor,T=void 0===P?hn:P,R=n.lassoLineWidth,O=void 0===R?2:R,B=n.lassoMinDelay,z=void 0===B?10:B,L=n.lassoMinDist,j=void 0===L?3:L,k=n.lassoClearEvent,F=void 0===k?mn:k,N=n.lassoInitiator,q=void 0!==N&&N,G=n.lassoInitiatorParentElement,H=void 0===G?document.body:G,K=n.keyMap,U=void 0===K?In:K,X=n.mouseMode,Y=void 0===X?un:X,J=n.showReticle,Q=void 0!==J&&J,tn=n.reticleColor,on=void 0===tn?Hn:tn,yn=n.pointColor,Gn=void 0===yn?Ln:yn,$n=n.pointColorActive,Jn=void 0===$n?jn:$n,ee=n.pointColorHover,ae=void 0===ee?kn:ee,le=n.showPointConnections,ue=void 0!==le&&le,fe=n.pointConnectionColor,ve=void 0===fe?Nn:fe,Me=n.pointConnectionColorActive,Se=void 0===Me?Vn:Me,Ae=n.pointConnectionColorHover,Ee=void 0===Ae?Wn:Ae,Ce=n.pointConnectionColorBy,Ie=void 0===Ce?_n:Ce,Pe=n.pointConnectionOpacity,Te=void 0===Pe?null:Pe,Re=n.pointConnectionOpacityBy,Oe=void 0===Re?Bn:Re,Be=n.pointConnectionOpacityActive,Ve=void 0===Be?.66:Be,qe=n.pointConnectionSize,Ue=void 0===qe?2:qe,Xe=n.pointConnectionSizeActive,Ye=void 0===Xe?2:Xe,$e=n.pointConnectionSizeBy,Je=void 0===$e?On:$e,Qe=n.pointConnectionMaxIntPointsPerSegment,nt=void 0===Qe?100:Qe,et=n.pointConnectionTolerance,tt=void 0===et?.002:et,ot=n.pointSize,rt=void 0===ot?6:ot,it=n.pointSizeSelected,at=void 0===it?2:it,ct=n.pointSizeMouseDetection,lt=void 0===ct?Kn:ct,ut=n.pointOutlineWidth,st=void 0===ut?2:ut,dt=n.opacity,ft=void 0===dt?nn:dt,vt=n.opacityBy,pt=void 0===vt?Dn:vt,ht=n.opacityByDensityFill,mt=void 0===ht?.15:ht,gt=n.opacityInactiveMax,yt=void 0===gt?1:gt,wt=n.opacityInactiveScale,xt=void 0===wt?1:wt,bt=n.sizeBy,Mt=void 0===bt?Rn:bt,St=n.height,At=void 0===St?Tn:St,Et=n.width,Ct=void 0===Et?Pn:Et,It=Ct===nn?1:Ct,Pt=At===nn?1:At,Tt=n.performanceMode,Rt=void 0!==Tt&&Tt,Ot=n.opacityByDensityDebounceTime,Bt=void 0===Ot?25:Ot;a||(a=be({regl:n.regl,gamma:n.gamma})),d=ge(d,!0),T=ge(T,!0),on=ge(on,!0);var Dt,zt,Lt,jt,kt,Ft,_t,Nt,Vt,Wt,Zt,qt,Gt,Ht,Kt,Ut,Xt,Yt=we(d),$t=!1,Jt=[],Qt=new Set,no=new Set,eo=null,to=[0,0],oo=0,ro=0,io=!1,ao=[],co=1,lo=ye(U),uo=!1,so=!0,fo=!1;Gn=pe(Gn)?s(Gn):[Gn],Jn=pe(Jn)?s(Jn):[Jn],ae=pe(ae)?s(ae):[ae],Gn=Gn.map((function(n){return ge(n,!0)})),Jn=Jn.map((function(n){return ge(n,!0)})),ae=ae.map((function(n){return ge(n,!0)})),ft=!Array.isArray(ft)&&Number.isNaN(+ft)?Gn[0][3]:ft,ft=te(ft,oe,{minLength:1})?s(ft):[ft];var vo,po,ho,mo,go=1/(rt=te(rt,oe,{minLength:1})?s(rt):[rt])[0];ve="inherit"===ve?s(Gn):(ve=pe(ve)?s(ve):[ve]).map((function(n){return ge(n,!0)})),Se="inherit"===Se?s(Jn):(Se=pe(Se)?s(Se):[Se]).map((function(n){return ge(n,!0)})),Ee="inherit"===Ee?s(ae):(Ee=pe(Ee)?s(Ee):[Ee]).map((function(n){return ge(n,!0)})),Te="inherit"===Te?s(ft):te(Te,oe,{minLength:1})?s(Te):[Te],Ue="inherit"===Ue?s(rt):te(Ue,oe,{minLength:1})?s(Ue):[Ue],M=He(M,zn),pt=He(pt,Dn,{allowDensity:!0}),Mt=He(Mt,Rn),Ie=He(Ie,_n,{allowSegment:!0}),Oe=He(Oe,Bn,{allowSegment:!0}),Je=He(Je,On,{allowSegment:!0});var yo,wo,xo,bo,Mo,So,Ao,Eo,Co,Io,Po,To,Ro=0,Oo=0,Bo=!1,Do=null,zo=Q,Lo=0,jo=0,ko=!1,Fo=!1,_o=0,No=0,Vo=!1,Wo=n.xScale||null,Zo=n.yScale||null,qo=0,Go=0,Ho=0,Ko=0;Wo&&(qo=Wo.domain()[0],Go=Wo.domain()[1]-Wo.domain()[0],Wo.range([0,It])),Zo&&(Ho=Zo.domain()[0],Ko=Zo.domain()[1]-Zo.domain()[0],Zo.range([Pt,0]));var Uo=function(n){return n/It*2-1},Xo=function(n){return 1+n/Pt*-2},Yo=function(){return[Uo(i[0]),Xo(i[1])]},$o=function(n,e){var o=[n,e,1,1];return b(o,o,g(t,y(t,kt,y(t,Dt.view,_t)))),o.slice(0,2)},Jo=function(){var n=pi(),e=Kt[1]-Ut[1];return Gt*n*(e/Pt)*.66},Qo=function(){var n,e=u(Yo(),2),t=e[0],o=e[1],r=u($o(t,o),2),i=r[0],a=r[1],c=Jo(),l=Lt.range(i-c,a-c,i+c,a+c),s=c;return l.forEach((function(e){var t=u(Lt.points[e],2),o=t[0],r=t[1],c=Qn(o,r,i,a);c<s&&(s=c,n=e)})),s<Gt/It*2?n:-1},nr=function(n,t){ao=n,zt.setPoints(t),e.publish("lassoExtend",{coordinates:n})},er=function(n){var e,t=ne(n),o=(e=Lt).range.apply(e,s(t)),r=[];return o.forEach((function(e){se(n,Lt.points[e])&&r.push(e)})),r},tr=function(){ao=[],zt&&zt.clear()},or=function(n){return n&&n.length>4},rr=function(n,e){if(!Wt&&ue&&or(Lt.points[n[0]])){var t=0===e,o=1===e?function(n){return no.add(n)}:V,r=Object.keys(n.reduce((function(n,e){var t=Lt.points[e];return n[Array.isArray(t[4])?t[4][0]:t[4]]=!0,n}),{})),i=Nt.getData().opacities;r.filter((function(n){return!no.has(+n)})).forEach((function(n){var e=Vt[n][0],r=Vt[n][2],a=4*e+2*Vt[n][3],c=a+2*r+4;void 0===i.__original__&&(i.__original__=i.slice());for(var l=a;l<c;l++)i[l]=t?i.__original__[l]:Ve;o(n)})),Nt.getBuffer().opacities.subdata(i,0)}},ir=function(n){return[n%Ro/Ro+Oo,Math.floor(n/Ro)/Ro+Oo]},ar=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.preventEvent,o=void 0!==t&&t;F===fn&&tr(),Jt.length&&(o||e.publish("deselect"),no.clear(),rr(Jt,0),Jt=[],Qt.clear(),so=!0)},cr=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t.merge,r=void 0!==o&&o,i=t.preventEvent,a=void 0!==i&&i,c=Array.isArray(n)?n:[n];r?Jt=Z(Jt,c):(Jt&&Jt.length&&rr(Jt,0),Jt=c);var l=[];Qt.clear(),no.clear();for(var u=Jt.length-1;u>=0;u--){var s=Jt[u];if(s<0||s>=oo)Jt.splice(u,1);else{Qt.add(s);var d=ir(s);l.push(d[0]),l.push(d[1])}}wo({usage:"dynamic",type:"float",data:l}),rr(Jt,1),a||e.publish("select",{points:Jt}),so=!0},lr=function(n){var e=h.getBoundingClientRect();return i[0]=n.clientX-e.left,i[1]=n.clientY-e.top,[].concat(i)},ur=function(){Dt.config({isFixed:!0}),$t=!0,io=!0,tr(),e.publish("lassoStart")},sr=function(n,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=o.merge,i=void 0!==r&&r;Dt.config({isFixed:!1}),ao=s(n);var a=er(t);cr(a,{merge:i}),e.publish("lassoEnd",{coordinates:ao}),F===vn&&tr()},dr=De(h,{onStart:ur,onDraw:nr,onEnd:sr,enableInitiator:q,initiatorParentElement:H,pointNorm:function(n){var e=u(n,2),t=e[0],o=e[1];return $o(Uo(t),Xo(o))}}),fr=function(){return Y===an},vr=function(n,e){switch(lo[e]){case bn:return n.altKey;case Mn:return n.metaKey;case Sn:return n.ctrlKey;case An:return n.metaKey;case En:return n.shiftKey;default:return!1}},pr=function(n){Fo&&($t=!0,eo=performance.now(),to=lr(n),io=fr()||vr(n,gn))},hr=function(n){Fo&&($t=!1,io&&(n.preventDefault(),io=!1,dr.end({merge:vr(n,wn)})))},mr=function(n){if(Fo){n.preventDefault();var e=lr(n);if(!(Qn.apply(void 0,s(e).concat(s(to)))>=j)){var t=performance.now()-eo;if(q&&t>500)dr.showInitiator(n);else{var o=Qo();o>=0?(Jt.length&&F===fn&&tr(),cr([o],{merge:vr(n,wn)})):Ht||(Ht=setTimeout((function(){Ht=null,dr.showInitiator(n)}),200))}}}},gr=function(n){dr.hideInitiator(),Ht&&(clearTimeout(Ht),Ht=null),A&&(n.preventDefault(),ar())},yr=function(n){Fo&&(Vo||$t)&&(lr(n),Vo&&!io&&ac(Qo()),io&&(n.preventDefault(),dr.extend(n,!0)),$t&&(so=!0))},wr=function(){Fo&&(+To>=0&&!Qt.has(To)&&rr([To],0),To=void 0,Vo=!1,hr(),so=!0)},xr=function(){var n=Math.max(rt.length,ft.length);jo=Math.max(2,Math.ceil(Math.sqrt(n)));for(var e=new Float32Array(4*Math.pow(jo,2)),t=0;t<n;t++){e[4*t]=rt[t]||0,e[4*t+1]=Math.min(1,ft[t]||0);var o=Number((Jn[t]||Jn[0])[3]);e[4*t+2]=Math.min(1,Number.isNaN(o)?1:o);var r=Number((ae[t]||ae[0])[3]);e[4*t+3]=Math.min(1,Number.isNaN(r)?1:r)}return a.regl.texture({data:e,shape:[jo,jo,4],type:"float"})},br=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Gn,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Jn,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ae,o=n.length,r=e.length,i=t.length,a=[];if(o===r&&r===i)for(var c=0;c<o;c++)a.push(n[c],e[c],t[c],d);else for(var l=0;l<o;l++){var u=[n[l][0],n[l][1],n[l][2],1],s=M===zn?e[0]:u,f=M===zn?t[0]:u;a.push(n[l],s,f,d)}return a},Mr=function(){var n=br(),e=n.length;Lo=Math.max(2,Math.ceil(Math.sqrt(e)));var t=new Float32Array(4*Math.pow(Lo,2));return n.forEach((function(n,e){t[4*e]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]})),a.regl.texture({data:t,shape:[Lo,Lo,4],type:"float"})},Sr=function(n,e){Ft[0]=n/jt,Ft[5]=e},Ar=function(){kt=x([],[1/(jt=It/Pt),1,1]),Ft=x([],[1/jt,1,1]),_t=x([],[co,1,1])},Er=function(n){+n<=0||(co=n)},Cr=function(n,e){return function(t){if(t&&t.length){var o=s(n()),r=pe(t)?t:[t];r=r.map((function(n){return ge(n,!0)})),Io&&Io.destroy();try{e(r),Io=Mr()}catch(n){console.error("Invalid colors. Switching back to default colors."),e(o),Io=Mr()}}}},Ir=Cr((function(){return Gn}),(function(n){Gn=n})),Pr=Cr((function(){return Jn}),(function(n){Jn=n})),Tr=Cr((function(){return ae}),(function(n){ae=n})),Rr=function(){var n=$o(-1,-1),e=$o(1,1),t=(n[0]+1)/2,o=(e[0]+1)/2,r=(n[1]+1)/2,i=(e[1]+1)/2;return[[qo+t*Go,qo+o*Go],[Ho+r*Ko,Ho+i*Ko]]},Or=function(){if(Wo||Zo){var n=u(Rr(),2),e=n[0],t=n[1];Wo&&Wo.domain(e),Zo&&Zo.domain(t)}},Br=function(n){Pt=Math.max(1,n),h.height=Math.floor(Pt*window.devicePixelRatio),Zo&&(Zo.range([Pt,0]),Or())},Dr=function(n){if(n===nn)return At=n,h.style.height="100%",void window.requestAnimationFrame((function(){h&&Br(h.getBoundingClientRect().height)}));!+n||+n<=0||(Br(At=+n),h.style.height="".concat(At,"px"))},zr=function(){Gt=lt,lt===nn&&(Gt=Array.isArray(rt)?rt[Math.floor(rt.length/2)]:rt)},Lr=function(n){te(n,oe,{minLength:1})&&(rt=s(n)),re(+n)&&(rt=[+n]),go=1/rt[0],Po=xr(),zr()},jr=function(n){!+n||+n<0||(at=+n)},kr=function(n){!+n||+n<0||(st=+n)},Fr=function(n){It=Math.max(1,n),h.width=Math.floor(It*window.devicePixelRatio),Wo&&(Wo.range([0,It]),Or())},_r=function(n){if(n===nn)return Ct=n,h.style.width="100%",void window.requestAnimationFrame((function(){h&&Fr(h.getBoundingClientRect().width)}));!+n||+n<=0||(Fr(Ct=+n),h.style.width="".concat(It,"px"))},Nr=function(n){te(n,oe,{minLength:1})&&(ft=s(n)),re(+n)&&(ft=[+n]),Po=xr()},Vr=function(n){switch(n){case"valueZ":return _o>1?"categorical":"continuous";case"valueW":return No>1?"categorical":"continuous";default:return null}},Wr=function(n,e){return"continuous"===n?function(n){return Math.round(n*(e.length-1))}:V},Zr=function(n){M=He(n,zn)},qr=function(n){pt=He(n,Dn,{allowDensity:!0})},Gr=function(n){Mt=He(n,Rn)},Hr=function(n){Ie=He(n,_n,{allowSegment:!0})},Kr=function(n){Oe=He(n,Bn,{allowSegment:!0})},Ur=function(n){Je=He(n,On,{allowSegment:!0})},Xr=function(){return[h.width,h.height]},Yr=function(){return v},$r=function(){return Io},Jr=function(){return Lo},Qr=function(){return.5/Lo},ni=function(){return window.devicePixelRatio},ei=function(){return yo},ti=function(){return wo},oi=function(){return Po},ri=function(){return jo},ii=function(){return.5/jo},ai=function(){return 0},ci=function(){return ho||vo},li=function(){return Ro},ui=function(){return.5/Ro},si=function(){return Ft},di=function(){return Dt.view},fi=function(){return _t},vi=function(){return y(o,Ft,y(o,Dt.view,_t))},pi=function(){return Dt.scaling[0]>1?Math.asinh(he(1,Dt.scaling[0]))/Math.asinh(1)*window.devicePixelRatio:he(go,Dt.scaling[0])*window.devicePixelRatio},hi=function(){return oo},mi=function(){return Jt.length},gi=function(){return mi()>0?yt:1},yi=function(){return mi()>0?xt:1},wi=function(){return+("valueZ"===M)},xi=function(){return+("valueW"===M)},bi=function(){return+("valueZ"===pt)},Mi=function(){return+("valueW"===pt)},Si=function(){return+("density"===pt)},Ai=function(){return+("valueZ"===Mt)},Ei=function(){return+("valueW"===Mt)},Ci=function(){return"valueZ"===M?_o<=1?Gn.length-1:1:No<=1?Gn.length-1:1},Ii=function(){return"valueZ"===pt?_o<=1?ft.length-1:1:No<=1?ft.length-1:1},Pi=function(){return"valueZ"===Mt?_o<=1?rt.length-1:1:No<=1?rt.length-1:1},Ti=function(n){if("density"!==pt)return 1;var e=pi(),t=rt[0]*e,o=2/(2/Dt.view[0])*(2/(2/Dt.view[5])),r=n.viewportHeight,i=n.viewportWidth,a=mt*i*r/(ro*t*t)*me(1,o);a*=Rt?1:1/(.25*Math.PI);var c=he(1,t)+.5;return a*=Math.pow(t/c,2),me(1,he(0,a))},Ri=a.regl({framebuffer:function(){return mo},vert:Ne,frag:_e,attributes:{position:[-4,0,4,4,4,-4]},uniforms:{startStateTex:function(){return po},endStateTex:function(){return vo},t:function(n,e){return e.t}},count:3}),Oi=function(n,e,t){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:gi,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:yi;return a.regl({frag:Rt?ke:je,vert:Fe(o),blend:{enable:!Rt,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},depth:{enable:!1},attributes:{stateIndex:{buffer:t,size:2}},uniforms:{resolution:Xr,modelViewProjection:vi,devicePixelRatio:ni,pointScale:pi,encodingTex:oi,encodingTexRes:ri,encodingTexEps:ii,pointOpacityMax:r,pointOpacityScale:i,pointSizeExtra:n,globalState:o,colorTex:$r,colorTexRes:Jr,colorTexEps:Qr,stateTex:ci,stateTexRes:li,stateTexEps:ui,isColoredByZ:wi,isColoredByW:xi,isOpacityByZ:bi,isOpacityByW:Mi,isOpacityByDensity:Si,isSizedByZ:Ai,isSizedByW:Ei,colorMultiplicator:Ci,opacityMultiplicator:Ii,opacityDensity:Ti,sizeMultiplicator:Pi,numColorStates:4},count:e,primitive:"points"})},Bi=Oi(ai,hi,ei),Di=Oi(ai,(function(){return 1}),(function(){return xo}),2,(function(){return 1}),(function(){return 1})),zi=Oi((function(){return(at+2*st)*window.devicePixelRatio}),mi,ti,1,(function(){return 1}),(function(){return 1})),Li=Oi((function(){return(at+st)*window.devicePixelRatio}),mi,ti,3,(function(){return 1}),(function(){return 1})),ji=Oi((function(){return at*window.devicePixelRatio}),mi,ti,1,(function(){return 1}),(function(){return 1})),ki=function(){zi(),Li(),ji()},Fi=a.regl({frag:ze,vert:Le,attributes:{position:[0,1,0,0,1,0,0,1,1,1,1,0]},uniforms:{modelViewProjection:vi,texture:Yr},count:6}),_i=a.regl({vert:"\n      precision mediump float;\n      uniform mat4 modelViewProjection;\n      attribute vec2 position;\n      void main () {\n        gl_Position = modelViewProjection * vec4(position, 0, 1);\n      }",frag:"\n      precision mediump float;\n      uniform vec4 color;\n      void main () {\n        gl_FragColor = vec4(color.rgb, 0.2);\n      }",depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},attributes:{position:function(){return ao}},uniforms:{modelViewProjection:vi,color:function(){return T}},elements:function(){return Array.from({length:ao.length-2},(function(n,e){return[0,e+1,e+2]}))}}),Ni=function(){if(To>=0){var n=u(Lt.points[To].slice(0,2),2),e=[n[0],n[1],0,1];y(t,Ft,y(t,Dt.view,_t)),b(e,e,t),Zt.setPoints([-1,e[1],1,e[1]]),qt.setPoints([e[0],1,e[0],-1]),Zt.draw(),qt.draw(),Oi((function(){return(at+2*st)*window.devicePixelRatio}),(function(){return 1}),xo,1)(),Oi((function(){return(at+st)*window.devicePixelRatio}),(function(){return 1}),xo,3)()}},Vi=function(n){for(var e=new Float32Array(2*n),t=0,o=0;o<n;++o){var r=ir(o);e[t]=r[0],e[t+1]=r[1],t+=2}return e},Wi=function(n){var e=n.length;Ro=Math.max(2,Math.ceil(Math.sqrt(e))),Oo=.5/Ro;var t=new Float32Array(4*Math.pow(Ro,2));_o=0,No=0;for(var o=0;o<e;++o)t[4*o]=n[o][0],t[4*o+1]=n[o][1],t[4*o+2]=n[o][2]||0,t[4*o+3]=n[o][3]||0,_o=Math.max(_o,t[4*o+2]),No=Math.max(No,t[4*o+3]);return a.regl.texture({data:t,shape:[Ro,Ro,4],type:"float"})},Zi=function(n){if(!vo)return!1;if(Bo){var e=po;po=ho,e.destroy()}else po=vo;return ho=Wi(n),mo=a.regl.framebuffer({color:ho,depth:!1,stencil:!1}),vo=void 0,!0},qi=function(){return Boolean(po&&ho)},Gi=function(){po&&(po.destroy(),po=void 0),ho&&(ho.destroy(),ho=void 0)},Hi=function(n){Fo=!1,oo=n.length,ro=oo,vo&&vo.destroy(),vo=Wi(n),yo({usage:"static",type:"float",data:Vi(oo)}),Lt=new D(n,(function(n){return n[0]}),(function(n){return n[1]}),16),Fo=!0},Ki=function(n,e){bo=Dt.target,Mo=n,So=Dt.distance[0],Ao=e},Ui=function(){return Boolean(void 0!==bo&&void 0!==Mo&&void 0!==So&&void 0!==Ao)},Xi=function(){bo=void 0,Mo=void 0,So=void 0,Ao=void 0},Yi=function(n){var e="inherit"===Ie?M:Ie;if("segment"===e){var t=ve.length-1;return t<1?[]:n.reduce((function(n,e,o){for(var r=0,i=[],a=2;a<e.length;a+=2){var c=Math.sqrt(Math.pow(e[a-2]-e[a],2)+Math.pow(e[a-1]-e[a+1],2));i.push(c),r+=c}n[o]=[0];for(var l=0,u=0;u<e.length/2-1;u++)l+=i[u],n[o].push(4*Math.floor(l/r*t));return n}),[])}if(e){var o=Ke(e),r=Wr(Vr(e),"inherit"===Ie?Gn:ve);return Vt.reduce((function(n,e){var t=u(e,2),i=t[0],a=t[1];return n[i]=4*r(a[o]),n}),[])}return Array(Vt.length).fill(0)},$i=function(){var n="inherit"===Oe?pt:Oe;if("segment"===n){var e=Te.length-1;return e<1?[]:Vt.reduce((function(n,t){var o=u(t,3),r=o[0];o[1];var i=o[2];return n[r]=W(i,(function(n){return Te[Math.floor(n/(i-1)*e)]})),n}),[])}if(n){var t=Ke(n),o="inherit"===Oe?ft:Te,r=Wr(Vr(n),o);return Vt.reduce((function(n,e){var i=u(e,2),a=i[0],c=i[1];return n[a]=o[r(c[t])],n}),[])}},Ji=function(){var n="inherit"===Je?Mt:Je;if("segment"===n){var e=Ue.length-1;return e<1?[]:Vt.reduce((function(n,t){var o=u(t,3),r=o[0];o[1];var i=o[2];return n[r]=W(i,(function(n){return Ue[Math.floor(n/(i-1)*e)]})),n}),[])}if(n){var t=Ke(n),o="inherit"===Je?rt:Ue,r=Wr(Vr(n),o);return Vt.reduce((function(n,e){var i=u(e,2),a=i[0],c=i[1];return n[a]=o[r(c[t])],n}),[])}},Qi=function(n){Vt=[];var e=0;Object.keys(n).forEach((function(t,o){Vt[t]=[o,n[t].reference,n[t].length/2,e],e+=n[t].length/2}))},na=function(n){return new Promise((function(e){Nt.setPoints([]),n&&n.length?(Wt=!0,We(n,{maxIntPointsPerSegment:nt,tolerance:tt}).then((function(n){Qi(n);var t=Object.values(n);Nt.setPoints(t,{colorIndices:Yi(t),opacities:$i(),widths:Ji()}),Wt=!1,e()}))):e()}))},ea=function(){return Lt.range(Ut[0],Ut[1],Kt[0],Kt[1])},ta=function(){ro=ea().length},oa=$(ta,Bt),ra=function(n){var e=u(bo,2),t=e[0],o=e[1],r=u(Mo,2),i=1-n,a=t*i+r[0]*n,c=o*i+r[1]*n,l=So*i+Ao*n;Dt.lookAt([a,c],l)},ia=function(){return qi()},aa=function(){return Ui()},ca=function(n,e){Do||(Do=performance.now());var t=performance.now()-Do,o=xe(e(t/n),0,1);return ia()&&Ri({t:o}),aa()&&ra(o),t<n},la=function(){Bo=!1,Do=null,Eo=void 0,Co=void 0,Q=zo,Gi(),Xi(),e.publish("transitionEnd")},ua=function(n){var t=n.duration,o=void 0===t?500:t,r=n.easing,i=void 0===r?dn:r;Bo&&e.publish("transitionEnd"),Bo=!0,Do=null,Eo=o,Co=de(i)?sn[i]||dn:i,zo=Q,Q=!1,e.publish("transitionStart")},sa=function(n){return new Promise((function(e,t){if(!n||Array.isArray(n))e(n);else{var o=Array.isArray(n.x)||ArrayBuffer.isView(n.x)?n.x.length:0,r=(Array.isArray(n.x)||ArrayBuffer.isView(n.x))&&function(e){return n.x[e]},i=(Array.isArray(n.y)||ArrayBuffer.isView(n.y))&&function(e){return n.y[e]},a=(Array.isArray(n.line)||ArrayBuffer.isView(n.line))&&function(e){return n.line[e]},c=(Array.isArray(n.lineOrder)||ArrayBuffer.isView(n.lineOrder))&&function(e){return n.lineOrder[e]},l=Object.keys(n),u=(f=l.find((function(n){return Un.has(n)})))&&(Array.isArray(n[f])||ArrayBuffer.isView(n[f]))&&function(e){return n[f][e]},s=(d=l.find((function(n){return Xn.has(n)})))&&(Array.isArray(n[d])||ArrayBuffer.isView(n[d]))&&function(e){return n[d][e]};r&&i&&u&&s&&a&&c?e(n.x.map((function(n,e){return[n,i(e),u(e),s(e),a(e),c(e)]}))):r&&i&&u&&s&&a?e(Array.from({length:o},(function(n,e){return[r(e),i(e),u(e),s(e),a(e)]}))):r&&i&&u&&s?e(Array.from({length:o},(function(n,e){return[r(e),i(e),u(e),s(e)]}))):r&&i&&u?e(Array.from({length:o},(function(n,e){return[r(e),i(e),u(e)]}))):r&&i?e(Array.from({length:o},(function(n,e){return[r(e),i(e)]}))):t(new Error("You need to specify at least x and y"))}var d,f}))},da=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return sa(n).then((function(n){return new Promise((function(o){var r=!1;n&&(t.transition&&(n.length===oo?r=Zi(n):console.warn("Cannot transition! The number of points between the previous and current draw call must be identical.")),Hi(n),(ue||t.showPointConnectionsOnce&&or(n[0]))&&na(n).then((function(){e.publish("pointConnectionsDraw"),so=!0,fo=t.showReticleOnce}))),t.transition&&r?(e.subscribe("transitionEnd",(function(){so=!0,fo=t.showReticleOnce,o()}),1),ua({duration:t.transitionDuration,easing:t.transitionEasing})):(e.subscribe("draw",o,1),so=!0,fo=t.showReticleOnce)}))}))},fa=function(n){return function(){var e=n.apply(void 0,arguments);return so=!0,e}},va=function(n){for(var e=1/0,t=-1/0,o=1/0,r=-1/0,i=0;i<n.length;i++){var a=u(Lt.points[n[i]],2),c=a[0],l=a[1];e=Math.min(e,c),t=Math.max(t,c),o=Math.min(o,l),r=Math.max(r,l)}return{x:e,y:o,width:t-e,height:r-o}},pa=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(o){var r=[n.x+n.width/2,n.y+n.height/2],i=2*Math.atan(1/Dt.view[5]),a=n.height*jt>n.width?n.height/2/Math.tan(i/2):n.width/2/Math.tan(i*jt/2);t.transition?(Dt.config({isFixed:!0}),Ki(r,a),e.subscribe("transitionEnd",(function(){o(),Dt.config({isFixed:!1})}),1),ua({duration:t.transitionDuration,easing:t.transitionEasing})):(Dt.lookAt(r,a),e.subscribe("draw",o,1),so=!0)}))},ha=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=va(n),o=t.x+t.width/2,r=t.y+t.height/2,i=Jo(),a=1+(e.padding||0),c=Math.max(t.width,i)*a,l=Math.max(t.height,i)*a,u=o-c/2,s=r-l/2;return pa({x:u,y:s,width:c,height:l},e)},ma=function(n,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise((function(r){o.transition?(Dt.config({isFixed:!0}),Ki(n,t),e.subscribe("transitionEnd",(function(){r(),Dt.config({isFixed:!1})}),1),ua({duration:o.transitionDuration,easing:o.transitionEasing})):(Dt.lookAt(n,t),e.subscribe("draw",r,1),so=!0)}))},ga=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ma([0,0],1,n)},ya=function(){Nt.setStyle({color:br(ve,Se,Ee),opacity:null===Te?null:Te[0],width:Ue[0]})},wa=function(){var n=Math.round(Yt)>0?0:255;dr.initiator.style.border="1px dashed rgba(".concat(n,", ").concat(n,", ").concat(n,", 0.33)"),dr.initiator.style.background="rgba(".concat(n,", ").concat(n,", ").concat(n,", 0.1)")},xa=function(n){n&&(d=ge(n,!0),Yt=we(d),wa())},ba=function(n){n?de(n)?ce(a.regl,n).then((function(n){v=n,so=!0,e.publish("backgroundImageReady")})).catch((function(){console.error("Count not create texture from ".concat(n)),v=null})):v="texture2d"===n._reglType?n:null:v=null},Ma=function(n){n>0&&Dt.lookAt(Dt.target,n,Dt.rotation)},Sa=function(n){null!==n&&Dt.lookAt(Dt.target,Dt.distance[0],n)},Aa=function(n){n&&Dt.lookAt(n,Dt.distance[0],Dt.rotation)},Ea=function(n){n&&Dt.setView(n)},Ca=function(n){n&&(T=ge(n,!0),zt.setStyle({color:T}))},Ia=function(n){Number.isNaN(+n)||+n<1||(O=+n,zt.setStyle({width:O}))},Pa=function(n){+n&&(z=+n,dr.set({minDelay:z}))},Ta=function(n){+n&&(j=+n,dr.set({minDist:j}))},Ra=function(n){F=ie(pn,F)(n)},Oa=function(n){q=Boolean(n),dr.set({enableInitiator:q})},Ba=function(n){H=n,dr.set({startInitiatorParentElement:H})},Da=function(n){U=Object.entries(n).reduce((function(n,e){var t=u(e,2),o=t[0],r=t[1];return Cn.includes(o)&&xn.includes(r)&&(n[o]=r),n}),{}),(lo=ye(U)).rotate?Dt.config({isRotate:!0,mouseDownMoveModKey:lo.rotate}):Dt.config({isRotate:!1})},za=function(n){Y=ie(ln,rn)(n),Dt.config({defaultMouseDownMoveAction:Y===cn?"rotate":"pan"})},La=function(n){null!==n&&(Q=n)},ja=function(n){n&&(on=ge(n,!0),Zt.setStyle({color:on}),qt.setStyle({color:on}))},ka=function(n){n&&(Wo=n,qo=n.domain()[0],Go=n?n.domain()[1]-n.domain()[0]:0,Wo.range([0,It]),Or())},Fa=function(n){n&&(Ho=(Zo=n).domain()[0],Ko=Zo?Zo.domain()[1]-Zo.domain()[0]:0,Zo.range([Pt,0]),Or())},_a=function(n){A=!!n},Na=function(n){I=!!n},Va=function(n){(ue=!!n)?or(Lt.points[0])&&na(Lt.points).then((function(){e.publish("pointConnectionsDraw"),so=!0})):na()},Wa=function(n,e){return function(t){if("inherit"===t)n(s(e()));else{var o=pe(t)?t:[t];n(o.map((function(n){return ge(n,!0)})))}ya()}},Za=Wa((function(n){ve=n}),(function(){return Gn})),qa=Wa((function(n){Se=n}),(function(){return Jn})),Ga=Wa((function(n){Ee=n}),(function(){return ae})),Ha=function(n){te(n,oe,{minLength:1})&&(Te=s(n)),re(+n)&&(Te=[+n]),ve=ve.map((function(n){return n[3]=Number.isNaN(+Te[0])?n[3]:+Te[0],n})),ya()},Ka=function(n){!Number.isNaN(+n)&&+n&&(Ve=+n)},Ua=function(n){te(n,oe,{minLength:1})&&(Ue=s(n)),re(+n)&&(Ue=[+n]),ya()},Xa=function(n){!Number.isNaN(+n)&&+n&&(Ye=Math.max(0,n))},Ya=function(n){nt=Math.max(0,n)},$a=function(n){tt=Math.max(0,n)},Ja=function(n){lt=n,zr()},Qa=function(n){mt=+n},nc=function(n){yt=+n},ec=function(n){xt=+n},tc=function(n){a.gamma=n},oc=function(n){return Ge({property:!0}),"aspectRatio"===n?co:"background"===n||"backgroundColor"===n?d:"backgroundImage"===n?v:"camera"===n?Dt:"cameraTarget"===n?Dt.target:"cameraDistance"===n?Dt.distance[0]:"cameraRotation"===n?Dt.rotation:"cameraView"===n?Dt.view:"canvas"===n?h:"colorBy"===n?M:"sizeBy"===n?Mt:"deselectOnDblClick"===n?A:"deselectOnEscape"===n?I:"height"===n?At:"lassoColor"===n?T:"lassoLineWidth"===n?O:"lassoMinDelay"===n?z:"lassoMinDist"===n?j:"lassoClearEvent"===n?F:"lassoInitiator"===n?q:"lassoInitiatorElement"===n?dr.initiator:"lassoInitiatorParentElement"===n?H:"keyMap"===n?c({},U):"mouseMode"===n?Y:"opacity"===n?1===ft.length?ft[0]:ft:"opacityBy"===n?pt:"opacityByDensityFill"===n?mt:"opacityByDensityDebounceTime"===n?Bt:"opacityInactiveMax"===n?yt:"opacityInactiveScale"===n?xt:"points"===n?Lt.points:"pointsInView"===n?ea():"pointColor"===n?1===Gn.length?Gn[0]:Gn:"pointColorActive"===n?1===Jn.length?Jn[0]:Jn:"pointColorHover"===n?1===ae.length?ae[0]:ae:"pointOutlineWidth"===n?st:"pointSize"===n?1===rt.length?rt[0]:rt:"pointSizeSelected"===n?at:"pointSizeMouseDetection"===n?lt:"showPointConnections"===n?ue:"pointConnectionColor"===n?1===ve.length?ve[0]:ve:"pointConnectionColorActive"===n?1===Se.length?Se[0]:Se:"pointConnectionColorHover"===n?1===Ee.length?Ee[0]:Ee:"pointConnectionColorBy"===n?Ie:"pointConnectionOpacity"===n?1===Te.length?Te[0]:Te:"pointConnectionOpacityBy"===n?Oe:"pointConnectionOpacityActive"===n?Ve:"pointConnectionSize"===n?1===Ue.length?Ue[0]:Ue:"pointConnectionSizeActive"===n?Ye:"pointConnectionSizeBy"===n?Je:"pointConnectionMaxIntPointsPerSegment"===n?nt:"pointConnectionTolerance"===n?tt:"reticleColor"===n?on:"regl"===n?a.regl:"showReticle"===n?Q:"version"===n?Ze:"width"===n?Ct:"xScale"===n?Wo:"yScale"===n?Zo:"performanceMode"===n?Rt:"gamma"===n?a.gamma:"renderer"===n?a:void 0},rc=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ge(n),void 0===n.backgroundColor&&void 0===n.background||xa(n.backgroundColor||n.background),void 0!==n.backgroundImage&&ba(n.backgroundImage),void 0!==n.cameraTarget&&Aa(n.cameraTarget),void 0!==n.cameraDistance&&Ma(n.cameraDistance),void 0!==n.cameraRotation&&Sa(n.cameraRotation),void 0!==n.cameraView&&Ea(n.cameraView),void 0!==n.colorBy&&Zr(n.colorBy),void 0!==n.pointColor&&Ir(n.pointColor),void 0!==n.pointColorActive&&Pr(n.pointColorActive),void 0!==n.pointColorHover&&Tr(n.pointColorHover),void 0!==n.pointSize&&Lr(n.pointSize),void 0!==n.pointSizeSelected&&jr(n.pointSizeSelected),void 0!==n.pointSizeMouseDetection&&Ja(n.pointSizeMouseDetection),void 0!==n.sizeBy&&Gr(n.sizeBy),void 0!==n.opacity&&Nr(n.opacity),void 0!==n.showPointConnections&&Va(n.showPointConnections),void 0!==n.pointConnectionColor&&Za(n.pointConnectionColor),void 0!==n.pointConnectionColorActive&&qa(n.pointConnectionColorActive),void 0!==n.pointConnectionColorHover&&Ga(n.pointConnectionColorHover),void 0!==n.pointConnectionColorBy&&Hr(n.pointConnectionColorBy),void 0!==n.pointConnectionOpacityBy&&Kr(n.pointConnectionOpacityBy),void 0!==n.pointConnectionOpacity&&Ha(n.pointConnectionOpacity),void 0!==n.pointConnectionOpacityActive&&Ka(n.pointConnectionOpacityActive),void 0!==n.pointConnectionSize&&Ua(n.pointConnectionSize),void 0!==n.pointConnectionSizeActive&&Xa(n.pointConnectionSizeActive),void 0!==n.pointConnectionSizeBy&&Ur(n.pointConnectionSizeBy),void 0!==n.pointConnectionMaxIntPointsPerSegment&&Ya(n.pointConnectionMaxIntPointsPerSegment),void 0!==n.pointConnectionTolerance&&$a(n.pointConnectionTolerance),void 0!==n.opacityBy&&qr(n.opacityBy),void 0!==n.lassoColor&&Ca(n.lassoColor),void 0!==n.lassoLineWidth&&Ia(n.lassoLineWidth),void 0!==n.lassoMinDelay&&Pa(n.lassoMinDelay),void 0!==n.lassoMinDist&&Ta(n.lassoMinDist),void 0!==n.lassoClearEvent&&Ra(n.lassoClearEvent),void 0!==n.lassoInitiator&&Oa(n.lassoInitiator),void 0!==n.lassoInitiatorParentElement&&Ba(n.lassoInitiatorParentElement),void 0!==n.keyMap&&Da(n.keyMap),void 0!==n.mouseMode&&za(n.mouseMode),void 0!==n.showReticle&&La(n.showReticle),void 0!==n.reticleColor&&ja(n.reticleColor),void 0!==n.pointOutlineWidth&&kr(n.pointOutlineWidth),void 0!==n.height&&Dr(n.height),void 0!==n.width&&_r(n.width),void 0!==n.aspectRatio&&Er(n.aspectRatio),void 0!==n.xScale&&ka(n.xScale),void 0!==n.yScale&&Fa(n.yScale),void 0!==n.deselectOnDblClick&&_a(n.deselectOnDblClick),void 0!==n.deselectOnEscape&&Na(n.deselectOnEscape),void 0!==n.opacityByDensityFill&&Qa(n.opacityByDensityFill),void 0!==n.opacityInactiveMax&&nc(n.opacityInactiveMax),void 0!==n.opacityInactiveScale&&ec(n.opacityInactiveScale),void 0!==n.gamma&&tc(n.gamma),new Promise((function(n){window.requestAnimationFrame((function(){h&&(Ar(),Dt.refresh(),a.refresh(),so=!0,n())}))}))},ic=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=e.preventEvent,o=void 0!==t&&t;Ea(n),so=!0,uo=o},ac=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t.showReticleOnce,r=void 0!==o&&o,i=t.preventEvent,a=void 0!==i&&i,c=!1;if(n>=0&&n<oo){c=!0;var l=To,u=n!==To;+l>=0&&u&&!Qt.has(l)&&rr([l],0),To=n,xo.subdata(ir(n)),Qt.has(n)||rr([n],2),u&&!a&&e.publish("pointover",To)}else(c=+To>=0)&&(Qt.has(To)||rr([To],0),a||e.publish("pointout",To)),To=void 0;c&&(so=!0,fo=r)},cc=function(){Dt||(Dt=E(h,{isPanInverted:[!1,!0]})),n.cameraView?Dt.setView(m(n.cameraView)):n.cameraTarget||n.cameraDistance||n.cameraRotation?Dt.lookAt(s(n.cameraTarget||Zn),n.cameraDistance||1,n.cameraRotation||0):Dt.setView(m(qn)),Kt=$o(1,1),Ut=$o(-1,-1)},lc=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.preventEvent,o=void 0!==t&&t;cc(),Or(),o||e.publish("view",{view:Dt.view,camera:Dt,xScale:Wo,yScale:Zo})},uc=function(n){if("Escape"===n.key)I&&ar()},sc=function(){Vo=!0},dc=function(){ac(),Vo=!1,so=!0},fc=function(){so=!0},vc=function(){Hi([]),Nt.clear()},pc=function(){Dt.refresh();var n=Ct===nn,e=At===nn;if(n||e){var t=h.getBoundingClientRect(),o=t.width,r=t.height;n&&Fr(o),e&&Br(r),Ar(),so=!0}},hc=function(){return h.getContext("2d").getImageData(0,0,h.width,h.height)},mc=function(){Ar(),cc(),Or(),zt=_(a.regl,{color:T,width:O,is2d:!0}),Nt=_(a.regl,{color:ve,colorHover:Ee,colorActive:Se,opacity:null===Te?null:Te[0],width:Ue[0],widthActive:Ye,is2d:!0}),Zt=_(a.regl,{color:on,width:1,is2d:!0}),qt=_(a.regl,{color:on,width:1,is2d:!0}),zr(),h.addEventListener("wheel",fc),yo=a.regl.buffer(),wo=a.regl.buffer(),xo=a.regl.buffer({usage:"dynamic",type:"float",length:2*en}),Io=Mr(),Po=xr();var n=rc({backgroundImage:v,width:Ct,height:At,keyMap:U});wa(),window.addEventListener("keyup",uc,!1),window.addEventListener("blur",wr,!1),window.addEventListener("mouseup",hr,!1),window.addEventListener("mousemove",yr,!1),h.addEventListener("mousedown",pr,!1),h.addEventListener("mouseenter",sc,!1),h.addEventListener("mouseleave",dc,!1),h.addEventListener("click",mr,!1),h.addEventListener("dblclick",gr,!1),"ResizeObserver"in window?(Xt=new ResizeObserver(pc)).observe(h):(window.addEventListener("resize",pc),window.addEventListener("orientationchange",pc)),n.then((function(){e.publish("init")}))},gc=a.onFrame((function(){ko=Dt.tick(),Fo&&(so||Bo)&&(Bo&&!ca(Eo,Co)&&la(),ko&&(Kt=$o(1,1),Ut=$o(-1,-1),"density"===pt&&oa()),a.render((function(n,e){Sr(n,e),v&&v._reglType&&Fi(),ao.length>2&&_i(),Bo||Nt.draw({projection:si(),model:fi(),view:di()}),Bi(),$t||!Q&&!fo||Ni(),To>=0&&Di(),Jt.length&&ki(),zt.draw({projection:si(),model:fi(),view:di()})}),h),ko&&(Or(),uo?uo=!1:e.publish("view",{view:Dt.view,camera:Dt,xScale:Wo,yScale:Zo})),so=!1,fo=!1,e.publish("draw"))})),yc=function(){so=!0},wc=function(){gc(),window.removeEventListener("keyup",uc,!1),window.removeEventListener("blur",wr,!1),window.removeEventListener("mouseup",hr,!1),window.removeEventListener("mousemove",yr,!1),h.removeEventListener("mousedown",pr,!1),h.removeEventListener("mouseenter",sc,!1),h.removeEventListener("mouseleave",dc,!1),h.removeEventListener("click",mr,!1),h.removeEventListener("dblclick",gr,!1),Xt?Xt.disconnect():(window.removeEventListener("resize",pc),window.removeEventListener("orientationchange",pc)),h=void 0,Dt.dispose(),Dt=void 0,zt.destroy(),Nt.destroy(),Zt.destroy(),qt.destroy(),e.publish("destroy"),e.clear(),n.renderer||a.destroy()};return mc(),{get isSupported(){return a.isSupported},clear:fa(vc),createTextureFromUrl:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yn;return ce(a.regl,n,e)},deselect:ar,destroy:wc,draw:da,get:oc,hover:ac,redraw:yc,refresh:a.refresh,reset:fa(lc),select:cr,set:rc,export:hc,subscribe:e.subscribe,unsubscribe:e.unsubscribe,view:ic,zoomToLocation:ma,zoomToArea:pa,zoomToPoints:ha,zoomToOrigin:ga}},Object.defineProperty(n,"__esModule",{value:!0})}));
